/*  Jam JavaScript Widget library, version 0.2.1
 *  (c) 2010 Oliver Nightingale
 *
 *  Released under MIT license.
 */

Jam={version:"0.2.1",newObjectFrom:function(e){function c(){}c.prototype=e;return new c}};
Jam.Base=function(e,c){var a={},b=c.containerSelector||"body",f=c.eventHandler||$(document);e=e;var m=$(c.templateSelector),l=c.widget;a.bind=function(k,n){f.bind(k+"."+(e+":"+l),n);return this};a.htmlClass=function(k){return e+" "+l+"-"+k};a.container=function(){return $(b)};a.generateHtml=function(){addBehaviour.call(this);return this.html};a.html=m.clone();a.insertHtml=function(){this.container().html(this.html)};a.options=function(){return c};a.render=function(){this.generateHtml();this.insertHtml()};
a.remove=function(){this.html.remove();f.unbind("."+(e+":"+l))};a.resetHtml=function(){this.html=m.clone()};a.trigger=function(k,n){f.trigger(k+"."+(e+":"+l),n)};return a};
Jam.CollectionView=function(e,c){var a=Jam.newObjectFrom(Jam.Base(e,c)),b=c.collection||[];a.collectionIsEmpty=function(){return b.length===0};a.collection=function(){return b};a.emptyCollection=function(){b=[];this.trigger("collectionEmptied")};a.setCollection=function(f){b=f;this.trigger("collectionUpdated",b);return b};a.updateCollection=function(f){b=f;this.trigger("collectionUpdated",b);this.resetHtml();this.render();return b};return a};
Jam.GridView=function(e,c){c=$.extend({paginationSpeed:800,paginationEasing:"swing"},c,{widget:"grid-view"});var a=Jam.newObjectFrom(Jam.CollectionView(e,c)),b=1,f=parseInt(c.perPage)||1,m=$('<ul class="grid-view-page clearfix"></ul>'),l=$('<div class="grid-view-page-controls"><a href="#" class="page-link backward">Prev</a><a href="#" class="page-link forward">Next</a></div>'),k=parseInt(a.options().pageWidth)/a.options().gridWidth+"px",n=$('<li class="grid-view-item"></li>').css({"float":"left",
width:k}),o=function(d){var g=(d-1)*c.perPage,i=d*c.perPage,h=m.clone();h.attr("id","grid-view-page-"+d);$.each(this.collection().slice(g,i),function(){h.append(n.clone().append(c.gridItemHtml(this).css({"margin-left":"auto","margin-right":"auto"})))});this.html.find(".grid-page-holder").append(h)},p=function(){var d=this,g,i=this.html.find(".grid-view-page-controls");i.unbind("click");i.bind("click",function(h){h=$(h.target);if($(this)!==h){if(h.hasClass("backward")){if(d.canPageBackward()){g=parseInt(b)-
1;d.trigger("paginate",parseInt(b)-1)}}else if(h.hasClass("forward")){if(d.canPageForward()){g=parseInt(b)+1;d.trigger("paginate",parseInt(b)+1)}}else if(h.hasClass("page-link")){g=parseInt(h.text());d.trigger("paginate",parseInt(h.text()))}d.showPage(g);i.find("a").removeClass("current").end().find(".page-link-"+g).addClass("current")}return false})},j=function(){return Math.ceil(a.collection().length/f)};a.canPageBackward=function(){return b>1};a.canPageForward=function(){return b!==j()};a.currentPage=
function(){return b};a.generateHtml=function(){if(this.collectionIsEmpty())c.blankStateHtml&&this.html.find(".grid-page-holder").append(m.clone().append(c.blankStateHtml));else{for(var d=1;d<=j();d++)o.call(this,d);if(j()>1){d=l.clone();for(var g=1;g<=j();g++){var i=$('<a href="#" class="page-link"></a>');i.text(g).addClass(g==b?"current":"").addClass("page-link-"+g);d.find(".forward").before(i)}this.html.find(".grid-view-page-controls")>0?this.html.find(".grid-view-page-controls").replaceWith(d):
this.html.append(d)}p.call(this);if(b>j())b=j();this.html.find(".grid-page-holder").css({left:-1*(b-1)*parseInt(c.pageWidth)+"px"})}this.container().css({width:c.pageWidth});this.html.find(".grid-page-holder").css({"min-width":"10000px",position:"absolute"}).end().find(".grid-view-port").css({overflow:"hidden",position:"relative",width:c.pageWidth,height:c.pageHeight}).end().find(".grid-view-page").css({padding:"0px","float":"left",width:c.pageWidth,height:c.pageHeight});return this.html.addClass(this.htmlClass())};
a.showPage=function(d){var g=this;d=parseInt(d);if(d<=j()&&d>0){b=d;this.trigger("pageAnimationStart",d);this.html.find(".grid-page-holder").animate({left:-1*(d-1)*parseInt(c.pageWidth)+"px"},c.paginationSpeed,c.paginationEasing,function(){g.trigger("pageAnimationEnd",d)});d>=j()-1&&g.trigger("collectionItemsNeeded")}else throw"cannot show a page that doesn't exist";};return a};
Jam.Helper=function(e){var c={};c.bytesToMegabytes=function(a){return Math.round(a/1048576*100)/100+"MB"};c.millisecondsToHrsMinSec=function(a){var b=a/1E3;a=Math.floor(b/3600);var f=Math.floor(b%3600/60);b=Math.floor(b%3600%60);return(a>0?a+":":"")+(f>0?(a>0&&f<10?"0":"")+f+":":"0:")+(b<10?"0":"")+b};c.numberToCurrency=function(a,b){return e.extend({},{currency:"\u00a3"},b||{}).currency+(new Number(a)).toFixed(2)};c.pageCentreX=function(a){return e("body").width()/2-a/2};c.pageCentreY=function(a){return e("body").height()/
2-a/2};c.timeAgoInWords=function(a){a=new Date((a||"").replace(/-/g,"/").replace(/[TZ]/g," "));a=((new Date).getTime()-a.getTime())/1E3;var b=Math.floor(a/86400);if(!(isNaN(b)||b<0||b>=31))return b==0&&(a<60&&"just now"||a<120&&"1 minute ago"||a<3600&&Math.floor(a/60)+" minutes ago"||a<7200&&"1 hour ago"||a<86400&&Math.floor(a/3600)+" hours ago")||b==1&&"yesterday"||b<7&&b+" days ago"||b<31&&Math.ceil(b/7)+" weeks ago"};c.truncateText=function(a,b){var f=0;b=b||100;a=a||"";if(a.length<=b)return a;
else if(a[b]!==" "){for(;a[b+f]!==" ";)f++;return a.slice(0,b+f)+"\u2026"}else return a.slice(0,b)+"\u2026"};c.viewPortTop=function(a){return e("body").scrollTop()+a};return c}(jQuery);
