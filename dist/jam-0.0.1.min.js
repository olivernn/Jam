/*  Jam JavaScript Widget library, version 0.0.1
 *  (c) 2010 Oliver Nightingale
 *
 *  Released under MIT license.
 */

Jam={version:"0.0.1"};Jam.GridView=function(b,c,f){f=f||{};b=b;c=c;var a=function(i,j){this.eventHandler=j?$(j):$(document);this.eventNamespace=b+":gridView";this.name=b;this.collection=i;this.settings=$.extend(Jam.GridView.defaults,c);this.page=1;this.html=$(this.settings.templateSelector).clone();this.holder=$(this.settings.holderSelector)};$.extend(a.prototype,Jam.GridView.instanceMethods,f);return a};
Jam.GridView.instanceMethods={canPageBackward:function(){return this.page>1},canPageForward:function(){return this.page!=this.pagesRequired},generateHtml:function(){function b(d){var h=(d-1)*a.settings.pageItems,e=d*a.settings.pageItems,g=i.clone();g.attr("id","grid-view-page-"+d);$.each(a.collection.slice(h,e),function(){g.append(j.clone().append(a.settings.gridItemHtml(this)))});a.html.find(".grid-page-holder").append(g)}function c(){function d(l){return a.settings.hashPagination?"#/"+a.name+"/page/"+
l:"#"}a.holder.find(".grid-view-page-controls").remove();var h=$('<div class="grid-view-page-controls"><a class="page-link backward">Prev</a><a class="page-link forward">Next</a></div>');h.find(".backward").attr("href",a.canPageBackward()?d(parseInt(a.page)-1):"#").click(function(){a.canPageBackward&&a.eventHandler.trigger("paginate."+a.eventNamespace,parseInt(a.page)-1)}).end().find(".forward").attr("href",a.canPageForward()?d(parseInt(a.page)+1):"#").click(function(){a.canPageForward()&&a.eventHandler.trigger("paginate."+
a.eventNamespace,parseInt(a.page)+1)});for(var e=1;e<=f();e++){var g=$('<a class="page-link"></a>');g.attr("href",d(e)).text(e).addClass(e==a.page?"current":"");h.find(".forward").before(g)}a.html.append(h)}function f(){a.pagesRequired=Math.ceil(a.collection.length/a.settings.pageItems);return a.pagesRequired}var a=this,i=$('<ul class="grid-view-page clearfix"></ul>'),j=$('<li class="grid-view-item"></li>').css({"float":"left",display:"inline"});if(a.collection.length>0){for(var k=1;k<=f();k++)b(k);
c();a.eventHandler.bind("pageAnimationStart."+this.eventNamespace,function(){c()})}else a.settings.blankStateHtml&&a.html.find(".grid-page-holder").append(i.clone().append(a.settings.blankStateHtml));a.holder.css({width:a.settings.pageWidth});a.html.find(".grid-page-holder").css({width:"10000px",position:"absolute"}).end().find(".grid-view-port").css({overflow:"hidden",position:"relative",width:a.settings.pageWidth,height:a.settings.pageHeight}).end().find(".grid-view-page").css({padding:"0px","float":"left",
width:a.settings.pageWidth});return this.html.addClass(this.name)},insertHtml:function(){this.holder.html(this.html)},render:function(){this.generateHtml();this.insertHtml()},remove:function(){this.holder.find("."+this.name).remove();this.eventHandler.unbind(this.name+":gridView")},showPage:function(b){var c=this;b=b;if(b<=c.pagesRequired&&b>0){this.page=b;this.eventHandler.trigger("pageAnimationStart."+this.eventNamespace,b);this.html.find(".grid-page-holder").animate({left:-1*(b-1)*parseInt(c.settings.pageWidth)+
"px"},this.settings.paginationSpeed,this.settings.paginationEasing,function(){c.eventHandler.trigger("pageAnimationEnd."+c.eventNamespace,b)});b>=c.pagesRequired-1&&this.eventHandler.trigger("collectionItemsNeeded."+this.eventNamespace)}else throw"cannot show a page that doesn't exist";}};Jam.GridView.defaults={paginationSpeed:1E3,paginationEasing:"swing",templateSelector:"#templates .grid-container"};
