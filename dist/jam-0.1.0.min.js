/*  Jam JavaScript Widget library, version 0.1.0
 *  (c) 2010 Oliver Nightingale
 *
 *  Released under MIT license.
 */

Jam={version:"0.1.0"};Jam.GridView=function(b,c,f){f=f||{};c=c||{};var i=function(a,h){this.eventHandler=h?$(h):$(document);this.eventNamespace=b+":gridView";this.name=b;this.collection=a;this.page=1;this.settings=c};$.extend(i.prototype,Jam.GridView.instanceMethods,f);return i};
Jam.GridView.instanceMethods={canPageBackward:function(){return this.page>1},canPageForward:function(){return this.page!=this.pagesRequired},generateHtml:function(){function b(){if(a.page>a.pagesRequired)a.page=a.pagesRequired;var d=-1*(a.page-1)*parseInt(a.settings.pageWidth)+"px";a.html.find(".grid-page-holder").css({left:d})}function c(d){var j=(d-1)*a.settings.pageItems,e=d*a.settings.pageItems,g=h.clone();g.attr("id","grid-view-page-"+d);$.each(a.collection.slice(j,e),function(){g.append(l.clone().append(a.settings.gridItemHtml(this)))});
a.html.find(".grid-page-holder").append(g)}function f(){function d(m){return a.settings.hashPagination?"#/"+a.name+"/page/"+m:"#"}a.holder.find(".grid-view-page-controls").remove();if(a.pagesRequired>1){var j=$('<div class="grid-view-page-controls"><a class="page-link backward">Prev</a><a class="page-link forward">Next</a></div>');j.find(".backward").attr("href",a.canPageBackward()?d(parseInt(a.page)-1):"#").click(function(){a.canPageBackward&&a.eventHandler.trigger("paginate."+a.eventNamespace,parseInt(a.page)-
1)}).end().find(".forward").attr("href",a.canPageForward()?d(parseInt(a.page)+1):"#").click(function(){a.canPageForward()&&a.eventHandler.trigger("paginate."+a.eventNamespace,parseInt(a.page)+1)});for(var e=1;e<=i();e++){var g=$('<a class="page-link"></a>');g.attr("href",d(e)).text(e).addClass(e==a.page?"current":"").click(function(){a.eventHandler.trigger("paginate."+a.eventNamespace,parseInt($(this).text()))});j.find(".forward").before(g)}a.html.append(j)}}function i(){a.pagesRequired=Math.ceil(a.collection.length/
a.settings.pageItems);return a.pagesRequired}var a=this;$.extend(this.settings,Jam.GridView.defaults);this.html=$(this.settings.templateSelector).clone();this.holder=$(this.settings.holderSelector);var h=$('<ul class="grid-view-page clearfix"></ul>'),l=$('<li class="grid-view-item"></li>').css({"float":"left"});if(a.collection.length>0){for(var k=1;k<=i();k++)c(k);f();a.eventHandler.bind("pageAnimationStart."+this.eventNamespace,function(){f()});b()}else a.settings.blankStateHtml&&a.html.find(".grid-page-holder").append(h.clone().append(a.settings.blankStateHtml));
a.holder.css({width:a.settings.pageWidth});a.html.find(".grid-page-holder").css({width:"10000px",position:"absolute"}).end().find(".grid-view-port").css({overflow:"hidden",position:"relative",width:a.settings.pageWidth,height:a.settings.pageHeight}).end().find(".grid-view-page").css({padding:"0px","float":"left",width:a.settings.pageWidth});return this.html.addClass(this.name)},insertHtml:function(){this.holder.html(this.html)},render:function(){this.generateHtml();this.insertHtml()},remove:function(){this.holder.find("."+
this.name).remove();this.eventHandler.unbind(this.name+":gridView")},showPage:function(b){var c=this;b=b;if(b<=c.pagesRequired&&b>0){this.page=b;this.eventHandler.trigger("pageAnimationStart."+this.eventNamespace,b);this.html.find(".grid-page-holder").animate({left:-1*(b-1)*parseInt(c.settings.pageWidth)+"px"},this.settings.paginationSpeed,this.settings.paginationEasing,function(){c.eventHandler.trigger("pageAnimationEnd."+c.eventNamespace,b)});b>=c.pagesRequired-1&&this.eventHandler.trigger("collectionItemsNeeded."+
this.eventNamespace)}else throw"cannot show a page that doesn't exist";},updateCollection:function(b){this.collection=b;this.render()}};Jam.GridView.defaults={paginationSpeed:1E3,paginationEasing:"swing",templateSelector:"#templates .grid-container"};
